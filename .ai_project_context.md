# AI Project Context: OBP Scala Library

**Last Updated**: 2025-01-09  
**Project Status**: ✅ Active Development - Publishing Pipeline Fixed  
**Current Version**: 0.1.0-SNAPSHOT

## 📋 Project Overview

### Purpose
Open Bank Project (OBP) Scala Library - A utility library for Scala applications working with the Open Bank Project API ecosystem.

### Key Technologies
- **Language**: Scala (cross-compiled)
- **Build Tool**: SBT 1.9.0
- **Scala Versions**: 2.12.17, 2.13.14, 3.3.1
- **Repository**: Nexus (Sonatype)
- **Containerization**: Docker + Docker Compose
- **Testing**: ScalaTest 3.2.19

### Repository Structure
```
OBP-Scala-Library/
├── .ai_project_context.md          # This file - AI assistant context
├── build.sbt                       # Main SBT build configuration
├── .env                            # Environment variables (gitignored)
├── source-env.sh                   # Convenience script for loading .env
├── .gitignore                      # Git ignore rules
├── README.md                       # Main project documentation
├── CREDENTIALS_QUICKSTART.md       # Quick setup guide for credentials
├── LICENSE                         # AGPL-3.0 license
├── src/                            # Source code
│   └── main/scala/                 # Scala source files
├── scripts/                        # Utility scripts
│   ├── setup-credentials.sh        # Interactive credential setup
│   └── publish-all.sh              # Publish to all Scala versions
├── docker/                         # Docker configuration
│   ├── docker-compose.yml          # Nexus + SBT services
│   └── sbt/Dockerfile              # Custom SBT container
├── docs/                           # Additional documentation
├── project/                        # SBT project configuration
├── target/                         # Build artifacts (gitignored)
├── java-example-app/               # Java integration example
└── scala-example-app/              # Scala usage example
```

## 🔧 Build Configuration

### Key Build Settings (build.sbt)
- **Organization**: `org.openbankproject`
- **Cross-compilation**: Scala 2.12.17, 2.13.14, 3.3.1
- **Version**: `0.1.0-SNAPSHOT` (for snapshots repo)
- **Repository**: Configured for Nexus with environment-based credentials

### Publishing Configuration
- **Snapshots**: `http://nexus:8081/repository/maven-snapshots/`
- **Releases**: `http://nexus:8081/repository/maven-releases/`
- **Credentials**: Environment variables (NEXUS_USERNAME, NEXUS_PASSWORD, etc.)

## 🐳 Development Environment

### Docker Setup
- **Nexus Container**: `sonatype/nexus3:latest` on port 8081
- **SBT Container**: Custom container with SBT 1.9.0
- **Network**: Internal docker network for service communication

### Environment Variables (.env)
```bash
NEXUS_USERNAME=admin
NEXUS_PASSWORD=[password]
NEXUS_HOST=nexus
NEXUS_URL=http://nexus:8081/
```

## 🚀 Common Workflows

### Quick Commands
```bash
# Setup credentials
./scripts/setup-credentials.sh

# Publish to all Scala versions
./scripts/publish-all.sh

# Publish to specific version
source .env && cd docker && docker-compose run --rm -T \
  -e NEXUS_USERNAME="$NEXUS_USERNAME" \
  -e NEXUS_PASSWORD="$NEXUS_PASSWORD" \
  -e NEXUS_HOST="$NEXUS_HOST" \
  -e NEXUS_URL="$NEXUS_URL" \
  sbt sbt "++2.13.14" "publish"

# Start development environment
cd docker && docker-compose up -d nexus

# Run tests
sbt test

# Local development
sbt publishLocal
```

### Development Workflow
1. Make code changes in `src/main/scala/`
2. Test locally: `sbt test`
3. Publish locally: `sbt publishLocal`
4. Publish to repository: `./scripts/publish-all.sh`

## 🔍 Recent Changes & Current Status

### ✅ Recently Fixed (2025-01-09)
- **Version Issue**: Changed from `0.1.0` to `0.1.0-SNAPSHOT` to fix Nexus HTTP 400 error
- **Publishing Pipeline**: Successfully tested cross-compilation to all Scala versions
- **Automation**: Created `publish-all.sh` script for easy publishing
- **Documentation**: Updated CREDENTIALS_QUICKSTART.md with correct commands

### 🎯 Current State
- ✅ Environment setup working
- ✅ Docker configuration functional
- ✅ Cross-compilation working (2.12, 2.13, 3.x)
- ✅ Publishing to Nexus snapshots successful
- ✅ Credential management secure and automated

## ⚠️ Important Notes

### Version Management
- **Snapshots**: Must end with `-SNAPSHOT` for maven-snapshots repo
- **Releases**: No `-SNAPSHOT` suffix for maven-releases repo
- **Current**: Using snapshots for development (0.1.0-SNAPSHOT)

### Security
- Credentials stored in `.env` (gitignored)
- File permissions set to 600 for security
- Environment variables used in build configuration
- No hardcoded passwords in source code

### Common Issues & Solutions
| Issue | Solution |
|-------|----------|
| HTTP 400 from Nexus | Check version matches repository type (SNAPSHOT vs release) |
| "Command not found" in Docker | Use proper docker-compose syntax with quoted arguments |
| Missing credentials | Run `./scripts/setup-credentials.sh` |
| Connection refused | Start Nexus: `cd docker && docker-compose up -d nexus` |

## 📚 Documentation Files

### Key Documentation
- `README.md` - Main project overview and setup
- `CREDENTIALS_QUICKSTART.md` - Fast credential setup guide
- `docs/` - Additional detailed documentation
- `.ai_project_context.md` - This context file for AI assistant

### Generated Files
- `source-env.sh` - Auto-generated by setup script
- `target/` - SBT build artifacts
- `.metals/` - Metals LSP cache

## 🧪 Testing & Quality

### Test Framework
- ScalaTest 3.2.19
- Located in `src/test/scala/`
- Run with: `sbt test`

### Code Quality
- Cross-compilation ensures compatibility
- Automated publishing pipeline
- Version management best practices

## 🔄 Maintenance Tasks

### Regular Updates
- Update Scala versions in `crossScalaVersions`
- Update dependency versions
- Update this context file when major changes occur
- Review and update documentation

### Monitoring
- Check Nexus repository for published artifacts
- Monitor Docker container health
- Verify cross-compilation continues working

---

## 🤖 AI Assistant Instructions

When working on this project:

1. **Always check** the current version in `build.sbt` and ensure it matches the intended repository
2. **Use the scripts** in `scripts/` directory for common tasks
3. **Follow the Docker workflow** for publishing - don't try to run SBT directly on host
4. **Update this file** when making significant changes to project structure or workflow
5. **Check recent changes section** to understand current project state
6. **Refer to documentation** in README.md and CREDENTIALS_QUICKSTART.md for user-facing instructions

### Quick Project Assessment Checklist
- [ ] Check `build.sbt` version format (SNAPSHOT vs release)
- [ ] Verify `.env` file exists and has correct format
- [ ] Confirm Docker containers can start
- [ ] Test publishing pipeline works
- [ ] Validate cross-compilation for all Scala versions
- [ ] Check documentation is up to date

**Remember**: This project uses Docker-based publishing exclusively. Always use the containerized workflow rather than direct SBT commands on the host system.